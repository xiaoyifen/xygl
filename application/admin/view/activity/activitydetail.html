{layout name="layout" /}
<link rel="stylesheet" href="__STATIC__/css/admin-form.css">
<link rel="stylesheet" href="__STATIC__/css/font-awesome.min.css">
<script type="text/javascript">
(function($){ //定义匿名函数并设置形参为$
$(function(){ //匿名函数内部的$均为jQuery
// 初始化文本编辑器
  $('#editor').summernote({                    
    minHeight: 300,             
    maxHeight: 500, 
    // width: 1000,       
    focus: false,   
    lang:'zh-CN',
    // 字体
    fontNames: [
      '宋体','楷体','Arial', 'Arial Black', 'Comic Sans MS', 'Courier New',
      'Helvetica Neue', 'Helvetica', 'Impact', 'Lucida Grande',
      'Tahoma', 'Times New Roman', 'Verdana'
    ],
    //工具栏
    toolbar: [
      ['style', ['bold', 'italic', 'underline', 'clear']],
      ['fontname', ['fontname']],
      ['fontsize', ['fontsize']],
      ['color', ['color']],
      ['para', ['ul', 'ol', 'paragraph']],
      ['height', ['height']],
      ['insert', ['link', 'picture']],
      ['imagesize', ['imageSize100', 'imageSize50', 'imageSize25']],
      ['view', ['codeview', 'help']]
    ],
    // 重写图片上传
    callbacks:{  
      onImageUpload: function(files, editor, $editable) {  
        sendFile(files,editor,$editable);  
      }  
    }
  });

  // 图片上传
  function sendFile(files,editor,$editable){
    var formData = new FormData();
    for(f in files){
      formData.append("image", files[f]);
    }
    $.ajax({
      data: formData,
      type: "POST",
      url: "{:url('news/upload_img')}",
      cache: false,
      contentType: false,
      processData: false,
      success: function(data) {
        $('#editor').summernote('editor.insertImage','__STATIC__/uploads/' + data.imagepath);
      },
      error: function() {
        alert("上传文件失败！");
      }
    });
  }

  // 审核理由
  $("#reason").blur(function() {
    if ($(this).val() == "" ) {  
      $("#reason1").html("<i class=\"icon-remove-sign bigger-120 red\"></i>&nbsp;&nbsp;提示：审核理由必须填写！");  
      $(this).focus();  
    }else{  
      $("#reason1").html(" ");  
    }  
  });

  // 是否显示审核理由
  $("input[name='status']").click(function () {
    if ($("input[name='status']:checked").val()==2) {
      $("#beWork").css("display","block");
      $("#reason1").html(" "); 
    }else{
      $("#beWork").css("display","none");
      $("#reason1").html(" ");
    }
  });

  // 表单验证
  $("form").submit(function(){
    if ($("#beWork").css("display") == "block") {
      // 审核理由不为空
      if ($("#reason").val() == "" ) {  
        $("#reason1").html("<i class=\"icon-remove-sign bigger-120 red\"></i>&nbsp;&nbsp;提示：审核理由必须填写！");  
        $("#reason").focus();  
      }
      // 验证为空，禁止提交
      if ($("#reason").val() == "") {
        return false;
      } 
    } 
  });

});
})(jQuery); 
</script>
<style type="text/css">
.cen {
  margin-top:35px;
}
</style>

<div class="panel-body" style="padding-bottom:0px;">
  <div class="panel panel-default">
    <div class="panel-heading">审核活动</div>
    <div class="panel-body body">
		{if !empty($list)}
		<form role="form" method="post" action="{:url('activity/audit',['id'=>$list['activityid']])}" enctype="multipart/form-data" class="form-horizontal">
    <input type="hidden" name="activityid" value="{$list['activityid']}">
    <input type="hidden" name="adminid" value="{$userid}">
		<div class="form-group">
			<label class="col-sm-2 control-label">活动标题</label>
			<div class="col-sm-9">
				<input type="text" class="form-control" id="disabledInput" placeholder="{$list['title']}" disabled />
			</div>
			<div class="col-sm-1"></div>
		</div>
		<div class="form-group">
			<label class="col-sm-2 control-label">活动标号</label>
			<div class="col-sm-9">
				<input type="text" class="form-control" id="disabledInput" placeholder="{$list['activityid']}" disabled />
			</div>
			<div class="col-sm-1"></div>
		</div>
		<div class="form-group">
			<label class="col-sm-2 control-label">活动发起人</label>
			<div class="col-sm-9">
				<input type="text" class="form-control" id="disabledInput" placeholder="{$list->stus->username}" disabled />
			</div>
			<div class="col-sm-1"></div>
		</div>
		<div class="form-group">
			<label class="col-sm-2 control-label">活动开始时间</label>
			<div class="col-sm-9">
				<input type="text" class="form-control" id="disabledInput" placeholder="{$list['activitytime']|date='Y-m-d H:i',###}" disabled />
			</div>
			<div class="col-sm-1"></div>
		</div>
		<div class="form-group">
			<label class="col-sm-2 control-label">活动结束时间</label>
			<div class="col-sm-9">
				<input type="text" class="form-control" id="disabledInput" placeholder="{$list['activitytime']|date='Y-m-d H:i',###}" disabled />
			</div>
			<div class="col-sm-1"></div>
		</div>
		<div class="form-group">
			<label class="col-sm-2 control-label">活动人数</label>
			<div class="col-sm-9">
				<input type="text" class="form-control" id="disabledInput" placeholder="{$list['number']}" disabled />
			</div>
			<div class="col-sm-1"></div>
		</div>
		<div class="form-group">
      <label for="editor" class="col-sm-2 control-label">活动介绍</label>
      <div class="col-sm-9">
        <textarea name="content" id="editor" class="form-control"  value="" style="height:100px;" disabled>{$list['content']}</textarea>
      </div>
      <div class="col-sm-1"></div>
    </div>
    <div class="form-group">
      <label for="check" class="col-sm-2 control-label">审核：</label>
      <div class="col-sm-9">
        <div class="checkbox-inline">
          <label>
            <input type="radio" name="status" id="status2" value="2" checked>未通过
          </label>
        </div>
        <div class="checkbox-inline">
          <label>
            <input type="radio" name="status" id="status1" value="1">通过
          </label>
        </div>
      </div>
      <div class="col-sm-1"></div>
    </div>
    <div class="form-group" id="beWork">
      <label for="reason" class="col-sm-2 control-label">理由<b>*</b>：</label>
      <div class="col-sm-6">
        <textarea name="reason" id="reason" class="form-control" value="" style="height:100px;" ></textarea>
      </div>
      <div class="col-sm-4 cen" id="reason1"></div>
    </div>
    <div class="form-group form-actions">
      <label for="submit" class="col-sm-1 control-label">&nbsp;</label>
      <div class="col-sm-offset-9 col-sm-1"><input name="submit" id="submit" type="submit" class="btn btn-info" value="提交" /></div>
      <div class="col-sm-1"> </div>
    </div>
		</form>
		{/if}	
	</div>
  </div>
</div>
